{% extends "layout.html" %}
{% set title = "AgroVision Nepal | Fund Campaigns" %}

{% block content %}

<div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
  <div>
    <h2 class="fw-bold mb-0">Agricultural Fund Campaigns</h2>
    <div class="text-muted small">Crowdfund local farming projects with basic risk screening.</div>
  </div>
  <a class="btn btn-outline-light btn-sm" href="{{ url_for('dashboard') }}">‚Üê Dashboard</a>
</div>

<div class="card card-agro mb-4 shadow-sm">
  <div class="card-body">
    <h6 class="fw-semibold mb-3">Create New Campaign</h6>

    <form method="POST" action="{{ url_for('create_fund') }}">
      <div class="mb-2">
        <input class="form-control" name="title" placeholder="Project Title" required>
      </div>

      <div class="mb-2">
        <textarea class="form-control" name="description" rows="3"
                  placeholder="Project Description" required></textarea>
      </div>

      <div class="row g-2">
        <div class="col-md-6">
          <input class="form-control" name="target_amount"
                 type="number" min="1" step="0.01"
                 placeholder="Target Amount (Rs.)" required>
        </div>

        <div class="col-md-6">
          <input class="form-control" name="duration_days"
                 type="number" min="1"
                 placeholder="Duration (days)" required>
        </div>
      </div>

      <div class="d-grid mt-3">
        <button class="btn btn-success btn-sm">Create Campaign</button>
      </div>
    </form>
  </div>
</div>

{% if not campaigns %}
  <div class="text-muted">No campaigns yet. Create your first one above.</div>
{% endif %}

{% for c in campaigns %}
  {% set target = (c.target_amount or 0) %}
  {% set raised = (c.raised_amount or 0) %}
  {% set pct = ( (raised / target) * 100 ) if target > 0 else 0 %}
  {% set trust = c.trust_label if c.trust_label else "Unknown" %}

  {% if trust == "High Trust" %}
    {% set badge = "success" %}
  {% elif trust == "Moderate Risk" %}
    {% set badge = "warning" %}
  {% else %}
    {% set badge = "danger" %}
  {% endif %}

  <div class="card card-agro shadow-sm mb-3">
    <div class="card-body">

      <div class="d-flex justify-content-between align-items-start gap-2">
        <div>
          <div class="fw-bold">{{ c.title }}</div>
          <div class="text-muted small mt-1">Duration: {{ c.duration_days }} days</div>
        </div>

        <span class="badge text-bg-{{ badge }}">{{ trust }}</span>
      </div>

      <div class="text-muted small mt-2">
        {{ c.description }}
      </div>

      <div class="mt-3">
        <div class="progress" style="height: 10px;">
          <div class="progress-bar bg-success" 
               data-width="{{ pct|round(0) }}">
        </div>

        <div class="small text-muted mt-1">
          Raised Rs. {{ raised }} of Rs. {{ target }} ({{ pct|round(0) }}%)
        </div>

        {% if c.risk_score is not none %}
          <div class="small text-muted mt-1">
            Risk score: <span class="text-light fw-semibold">{{ c.risk_score }}</span>/100
          </div>
        {% endif %}
      </div>

    </div>
  </div>
{% endfor %}

{% endblock %}
